<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Stoc Farma Pro v6.4 - Enter Edit</title>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --danger: #ef4444; --bg: #f8fafc; --border: #cbd5e1; }
        body { font-family: 'Inter', system-ui, sans-serif; margin: 0; background: var(--bg); color: var(--primary); }
        .top-bar { background: var(--primary); color: white; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .main-container { padding: 12px; max-width: 1400px; margin: auto; }
        .controls { display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; padding-bottom: 5px; }
        .btn { padding: 10px 16px; border-radius: 8px; font-weight: bold; border: 1px solid var(--border); cursor: pointer; white-space: nowrap; font-size: 0.85rem; }
        .btn-blue { background: var(--accent); color: white; border: none; }
        .btn-white { background: white; color: var(--primary); }
        .btn-delete { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; padding: 6px 10px; border-radius: 6px; }
        .search-box { width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 12px; font-size: 1rem; margin-bottom: 10px; }
        .table-card { background: white; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
        .table-responsive { width: 100%; overflow-x: auto; max-height: 72vh; }
        table { width: 100%; border-collapse: collapse; min-width: 950px; }
        th { background: #f1f5f9; padding: 12px; text-align: left; font-size: 0.75rem; text-transform: uppercase; color: #475569; border-bottom: 2px solid var(--border); position: sticky; top: 0; z-index: 10; }
        td { padding: 6px 10px; border-bottom: 1px solid #e2e8f0; }
        .input-inline { border: 1px solid transparent; background: transparent; padding: 8px; width: 100%; border-radius: 6px; font-size: 0.95rem; font-weight: 500; }
        .input-inline:focus { background: #f1f5f9; border-color: var(--accent); outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }
        .qty-box { width: 65px; border: 1.5px solid #cbd5e1; border-radius: 6px; padding: 6px; text-align: center; font-weight: bold; }
        .row-expirat { background-color: #fff1f2 !important; }
    </style>
</head>
<body>

<div class="top-bar">
    <h1 style="font-size: 0.9rem; margin:0;">STOC FARMA PRO v6.4</h1>
    <button class="btn btn-white" style="background: #4f46e5; color:white; border:none;" onclick="toggleModInventar()">MOD INVENTAR</button>
</div>

<div class="main-container">
    <div id="normalControls" class="controls">
        <button class="btn btn-blue" onclick="adaugaProdusNou()">+ PRODUS</button>
        <button class="btn btn-white" onclick="document.getElementById('excelInput').click()">ðŸ“¥ IMPORT</button>
        <button class="btn btn-white" onclick="creeazaBackup()">ðŸ’¾ BACKUP</button>
        <button class="btn btn-white" onclick="document.getElementById('restoreInput').click()">ðŸ”„ RESTORE</button>
        <button class="btn btn-white" style="color: #d97706;" onclick="exportaJurnal()">ðŸ“‹ JURNAL AUDIT</button>
        <input type="file" id="excelInput" style="display: none;" accept=".xlsx, .xls" onchange="importaExcel(event)" />
        <input type="file" id="restoreInput" style="display: none;" accept=".json" onchange="restaurareBackup(event)" />
    </div>

    <input type="text" id="searchInput" class="search-box" placeholder="ðŸ”Ž CautÄƒ produs... (ApasÄƒ Enter pentru a salva editÄƒrile)" onkeyup="afiseaza()">

    <div class="table-card">
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th style="width:100px">AcÈ›iuni</th>
                        <th style="width:30%">Produs</th>
                        <th>Emb.</th>
                        <th style="text-align:center">Stoc (I / F)</th>
                        <th>Expirare (ZZ/LL/AA)</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="listaCorp"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const db = new Dexie("FarmaProV6_4");
    db.version(1).stores({ 
        produse: '++id, nume, cantitate

